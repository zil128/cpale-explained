<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pricing - CPALE Explained</title>
    <meta name="description" content="Choose your plan and start your CPALE journey. Affordable pricing for every aspiring CPA.">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts: Space Grotesk + Plus Jakarta Sans -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">

    <!-- Custom Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#7C3AED',
                        secondary: '#10B981',
                        accent: '#F472B6',
                        lavender: '#FDF4FF',
                        mint: '#ECFDF5',
                        peach: '#FFF7ED',
                    },
                    fontFamily: {
                        heading: ['Space Grotesk', 'sans-serif'],
                        body: ['Plus Jakarta Sans', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Space Grotesk', sans-serif;
        }

        /* Mesh Gradient Background */
        .mesh-gradient {
            background:
                radial-gradient(at 40% 20%, #FDF4FF 0px, transparent 50%),
                radial-gradient(at 80% 0%, #ECFDF5 0px, transparent 50%),
                radial-gradient(at 0% 50%, #FEE2E2 0px, transparent 50%),
                radial-gradient(at 80% 50%, #E0E7FF 0px, transparent 50%),
                radial-gradient(at 0% 100%, #FCE7F3 0px, transparent 50%),
                radial-gradient(at 80% 100%, #D1FAE5 0px, transparent 50%),
                linear-gradient(135deg, #7C3AED 0%, #A78BFA 50%, #F472B6 100%);
        }

        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .glass-purple {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.1) 0%, rgba(167, 139, 250, 0.1) 100%);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(124, 58, 237, 0.2);
        }

        /* Floating Animation */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(124, 58, 237, 0.3); }
            50% { box-shadow: 0 0 40px rgba(124, 58, 237, 0.5); }
        }

        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .animate-float {
            animation: float 3s ease-in-out infinite;
        }

        .animate-pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }

        /* Tab styling */
        .tab-btn {
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #7C3AED 0%, #A78BFA 100%);
            color: white;
            transform: scale(1.05);
        }

        /* Pricing card hover effect */
        .pricing-card {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .pricing-card:hover {
            transform: translateY(-8px) scale(1.02);
        }

        .pricing-card.featured {
            border: 2px solid #7C3AED;
            position: relative;
            overflow: visible;
        }

        .pricing-card.featured::before {
            content: 'MOST POPULAR';
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #7C3AED 0%, #F472B6 100%);
            color: white;
            padding: 4px 16px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 1px;
        }

        /* Savings badge */
        .savings-badge {
            background: linear-gradient(135deg, #10B981 0%, #34D399 100%);
            animation: pulse-glow 2s ease-in-out infinite;
        }

        /* Decorative blobs */
        .blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(60px);
            opacity: 0.5;
            z-index: 0;
        }

        /* Payment provider buttons */
        .payment-btn {
            transition: all 0.3s ease;
        }

        .payment-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(124, 58, 237, 0.2);
        }

        .payment-btn.selected {
            border-color: #7C3AED;
            background: rgba(124, 58, 237, 0.1);
        }

        /* Confetti effect for checkout */
        @keyframes confetti {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-100vh) rotate(720deg); opacity: 0; }
        }
    </style>
</head>
<body class="min-h-screen mesh-gradient">
    <!-- Decorative blobs -->
    <div class="blob w-96 h-96 bg-purple-400 top-20 -left-48"></div>
    <div class="blob w-80 h-80 bg-pink-400 top-1/3 right-0"></div>
    <div class="blob w-64 h-64 bg-emerald-400 bottom-20 left-1/4"></div>

    <!-- Navigation -->
    <nav class="glass fixed w-full z-50 px-6 py-4">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <a href="index.html" class="flex items-center space-x-2">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-primary to-accent flex items-center justify-center">
                    <span class="text-white font-bold text-lg">C</span>
                </div>
                <span class="font-heading font-bold text-xl text-gray-800">CPALE Explained</span>
            </a>
            <div class="hidden md:flex items-center space-x-6">
                <a href="index.html" class="text-gray-600 hover:text-primary transition">Home</a>
                <a href="pricing.html" class="text-primary font-semibold">Pricing</a>
                <a href="login.html" class="text-gray-600 hover:text-primary transition">Login</a>
                <a href="register.html" class="px-5 py-2 bg-gradient-to-r from-primary to-accent text-white rounded-full font-semibold hover:shadow-lg hover:shadow-primary/30 transition">
                    Get Started
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="relative z-10 pt-28 pb-20 px-4">
        <div class="max-w-6xl mx-auto">
            <!-- Header -->
            <div class="text-center mb-12">
                <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-4">
                    Choose Your
                    <span class="bg-gradient-to-r from-primary via-accent to-secondary bg-clip-text text-transparent">
                        CPALE Journey
                    </span>
                </h1>
                <p class="text-lg text-gray-600 max-w-2xl mx-auto">
                    Invest in your future. Pass the CPA Licensure Exam with confidence.
                </p>
            </div>

            <!-- Pricing Cards -->
            <div class="grid md:grid-cols-2 gap-6 md:gap-8 max-w-4xl mx-auto" id="pricingCards">
                <!-- FREE Plan -->
                <div class="pricing-card glass rounded-3xl p-8 relative">
                    <div class="mb-6">
                        <span class="text-sm font-semibold text-gray-500 uppercase tracking-wider">Starter</span>
                        <h3 class="text-2xl font-bold text-gray-800 mt-1">Free Plan</h3>
                    </div>
                    <div class="mb-6">
                        <span class="text-5xl font-bold text-gray-800">P0</span>
                        <span class="text-gray-500">/forever</span>
                    </div>
                    <p class="text-gray-600 mb-6">Perfect for getting started and testing the waters.</p>
                    <ul class="space-y-3 mb-8">
                        <li class="flex items-center text-gray-600">
                            <svg class="w-5 h-5 text-emerald-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            <span><strong>50 MCQs</strong> across all subjects</span>
                        </li>
                        <li class="flex items-center text-gray-600">
                            <svg class="w-5 h-5 text-emerald-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            <span>All 6 CPALE subjects</span>
                        </li>
                        <li class="flex items-center text-gray-600">
                            <svg class="w-5 h-5 text-emerald-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            <span>Unlimited repetition</span>
                        </li>
                        <li class="flex items-center text-gray-600">
                            <svg class="w-5 h-5 text-emerald-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            <span>Basic progress tracking</span>
                        </li>
                        <li class="flex items-center text-gray-400">
                            <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                            </svg>
                            <span>Practice Sets</span>
                        </li>
                        <li class="flex items-center text-gray-400">
                            <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                            </svg>
                            <span>Mock Preboard Exams</span>
                        </li>
                    </ul>
                    <a href="register.html" class="block w-full py-3 px-6 text-center border-2 border-gray-300 text-gray-700 font-semibold rounded-xl hover:border-primary hover:text-primary transition">
                        Start Free
                    </a>
                </div>

                <!-- PAID Plan -->
                <div class="pricing-card featured glass rounded-3xl p-8 relative animate-pulse-glow" id="paidCard">
                    <div class="mb-6">
                        <span class="text-sm font-semibold text-accent uppercase tracking-wider">Best Value</span>
                        <h3 class="text-2xl font-bold text-gray-800 mt-1">Paid Plan</h3>
                    </div>
                    <div class="mb-6">
                        <span class="text-5xl font-bold bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent">P149</span>
                        <span class="text-gray-500">/month</span>
                    </div>
                    <p class="text-gray-600 mb-6">Unlock all content for 30 days.</p>
                    <ul class="space-y-3 mb-8">
                        <li class="flex items-center text-gray-600">
                            <svg class="w-5 h-5 text-emerald-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            <span><strong>Unlimited MCQs</strong> across all subjects</span>
                        </li>
                        <li class="flex items-center text-gray-600">
                            <svg class="w-5 h-5 text-emerald-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            <span>All 6 CPALE subjects</span>
                        </li>
                        <li class="flex items-center text-gray-600">
                            <svg class="w-5 h-5 text-emerald-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            <span><strong>Practice Sets</strong> (75 MCQs each)</span>
                        </li>
                        <li class="flex items-center text-gray-600">
                            <svg class="w-5 h-5 text-emerald-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            <span>Basic analytics dashboard</span>
                        </li>
                        <li class="flex items-center text-gray-600">
                            <svg class="w-5 h-5 text-emerald-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            <span>Email support</span>
                        </li>
                        <li class="flex items-center text-gray-600">
                            <svg class="w-5 h-5 text-emerald-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            <span><strong>30 days</strong> access</span>
                        </li>
                    </ul>
                    <button onclick="selectPlan('PAID_MONTHLY')" class="block w-full py-3 px-6 text-center bg-gradient-to-r from-primary via-accent to-pink-500 text-white font-semibold rounded-xl hover:shadow-lg hover:shadow-accent/30 transition">
                        Upgrade to Paid
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Payment Modal -->
    <div id="paymentModal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 bg-black/50 backdrop-blur-sm">
        <div class="glass rounded-3xl max-w-lg w-full p-8 relative animate-float">
            <button onclick="closePaymentModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>

            <h3 class="text-2xl font-bold text-gray-800 mb-2">Complete Your Purchase</h3>
            <p class="text-gray-600 mb-6" id="selectedPlanInfo">You selected: Basic Monthly - P149</p>

            <!-- Promo Code -->
            <div class="mb-6">
                <label class="block text-sm font-semibold text-gray-700 mb-2">Have a promo code?</label>
                <div class="flex space-x-2">
                    <input type="text" id="promoCodeInput" placeholder="Enter code" class="flex-1 px-4 py-2 border border-gray-200 rounded-xl focus:outline-none focus:border-primary">
                    <button onclick="applyPromoCode()" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition font-semibold">
                        Apply
                    </button>
                </div>
                <p id="promoMessage" class="text-sm mt-2 hidden"></p>
            </div>

            <!-- Price Summary -->
            <div class="bg-gray-50 rounded-xl p-4 mb-6">
                <div class="flex justify-between mb-2">
                    <span class="text-gray-600">Subtotal</span>
                    <span id="subtotalPrice" class="font-semibold">P149.00</span>
                </div>
                <div id="discountRow" class="flex justify-between mb-2 hidden">
                    <span class="text-emerald-600">Discount</span>
                    <span id="discountAmount" class="text-emerald-600 font-semibold">-P0.00</span>
                </div>
                <div class="border-t border-gray-200 pt-2 flex justify-between">
                    <span class="font-bold text-gray-800">Total</span>
                    <span id="totalPrice" class="font-bold text-xl text-primary">P149.00</span>
                </div>
            </div>

            <!-- Payment Methods -->
            <div class="mb-6">
                <label class="block text-sm font-semibold text-gray-700 mb-3">Choose payment method</label>
                <div class="grid grid-cols-3 gap-3" id="paymentMethods">
                    <button onclick="selectPaymentMethod('GCASH')" class="payment-btn flex flex-col items-center p-4 border-2 border-gray-200 rounded-xl hover:border-primary">
                        <img src="images/gcash-logo.png" alt="GCash" class="h-8 mb-2" onerror="this.src='https://via.placeholder.com/80x32?text=GCash'">
                        <span class="text-sm font-medium text-gray-700">GCash</span>
                    </button>
                    <button onclick="selectPaymentMethod('PAYMAYA')" class="payment-btn flex flex-col items-center p-4 border-2 border-gray-200 rounded-xl hover:border-primary">
                        <img src="images/paymaya-logo.png" alt="Maya" class="h-8 mb-2" onerror="this.src='https://via.placeholder.com/80x32?text=Maya'">
                        <span class="text-sm font-medium text-gray-700">Maya</span>
                    </button>
                    <button onclick="selectPaymentMethod('BANK_TRANSFER')" class="payment-btn flex flex-col items-center p-4 border-2 border-gray-200 rounded-xl hover:border-primary">
                        <img src="images/bank-logo.png" alt="Bank" class="h-8 mb-2" onerror="this.src='https://via.placeholder.com/80x32?text=Bank'">
                        <span class="text-sm font-medium text-gray-700">Bank</span>
                    </button>
                </div>
            </div>

            <!-- Payment Instructions -->
            <div id="paymentInstructions" class="hidden bg-lavender rounded-xl p-4 mb-6">
                <h4 class="font-semibold text-gray-800 mb-2">Payment Instructions</h4>
                <div id="instructionsText" class="text-sm text-gray-700 whitespace-pre-line mb-4"></div>
                <div class="bg-white rounded-lg p-3 mb-3">
                    <p class="text-xs font-semibold text-gray-600 mb-1">Account Details:</p>
                    <p class="text-sm font-mono text-gray-800" id="accountDetails"></p>
                </div>
            </div>

            <!-- Payment Proof Upload (shown after initiating payment) -->
            <div id="uploadSection" class="hidden mb-6">
                <div class="bg-blue-50 border border-blue-200 rounded-xl p-4 mb-4">
                    <p class="text-sm text-blue-800 font-semibold mb-2">âœ“ Payment initiated!</p>
                    <p class="text-xs text-blue-700">Reference: <span id="paymentReference" class="font-mono font-bold"></span></p>
                </div>
                
                <label class="block text-sm font-semibold text-gray-700 mb-2">Upload Payment Proof</label>
                <div class="border-2 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-primary transition">
                    <input type="file" id="proofFile" accept="image/*,.pdf" class="hidden" onchange="handleFileSelect(event)">
                    <label for="proofFile" class="cursor-pointer">
                        <svg class="w-12 h-12 mx-auto text-gray-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                        </svg>
                        <p class="text-sm text-gray-600 mb-1">Click to upload screenshot/receipt</p>
                        <p class="text-xs text-gray-400">PNG, JPG or PDF (max 5MB)</p>
                    </label>
                </div>
                <div id="selectedFile" class="hidden mt-3 p-3 bg-green-50 border border-green-200 rounded-lg">
                    <p class="text-sm text-green-800">
                        <span class="font-semibold">Selected:</span> 
                        <span id="fileName"></span>
                    </p>
                </div>

                <!-- Additional Info -->
                <div class="mt-4 space-y-3">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Your Name (on payment)</label>
                        <input type="text" id="payerName" placeholder="Juan Dela Cruz" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:outline-none focus:border-primary">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Contact Number</label>
                        <input type="text" id="payerContact" placeholder="09171234567" class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:outline-none focus:border-primary">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Notes (optional)</label>
                        <textarea id="paymentNotes" placeholder="Transaction reference, remarks, etc." class="w-full px-4 py-2 border border-gray-200 rounded-xl focus:outline-none focus:border-primary" rows="2"></textarea>
                    </div>
                </div>
            </div>

            <!-- Proceed Button -->
            <button onclick="proceedToPayment()" id="proceedBtn" disabled class="w-full py-4 bg-gradient-to-r from-primary to-accent text-white font-bold rounded-xl disabled:opacity-50 disabled:cursor-not-allowed hover:shadow-lg hover:shadow-primary/30 transition">
                <span id="proceedBtnText">Select Payment Method</span>
            </button>

            <p class="text-xs text-center text-gray-500 mt-4">
                By proceeding, you agree to our Terms of Service and Privacy Policy.
            </p>
        </div>
    </div>

    <!-- Payment Confirmation Modal -->
    <div id="confirmationModal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 bg-black/50 backdrop-blur-sm">
        <div class="glass rounded-3xl max-w-md w-full p-8 text-center">
            <div class="w-16 h-16 bg-gradient-to-br from-emerald-400 to-emerald-600 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                </svg>
            </div>
            <h3 class="text-2xl font-bold text-gray-800 mb-2">Payment Initiated!</h3>
            <p class="text-gray-600 mb-4">Your reference number:</p>
            <div class="bg-gray-100 rounded-xl p-4 mb-6">
                <span id="referenceNumber" class="text-xl font-mono font-bold text-primary">CPALE-20260116-XXXXX</span>
            </div>
            <p class="text-sm text-gray-600 mb-6" id="confirmInstructions">
                Please complete your payment using the selected method. Once confirmed, your subscription will be activated within 24 hours.
            </p>
            <button onclick="closeConfirmationModal()" class="w-full py-3 bg-gradient-to-r from-primary to-accent text-white font-bold rounded-xl hover:shadow-lg transition">
                Got it!
            </button>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:5000/api';

        // State
        let selectedPlanCode = null;
        let selectedPaymentMethod = null;
        let appliedPromo = null;
        let currentPrice = 0;
        let currentPaymentId = null;
        let selectedFile = null;
        let paymentMethods = [];

        // Plans data (simplified to 2 plans)
        const plansData = {
            'FREE': { code: 'FREE', price: 0, name: 'Free Plan' },
            'PAID_MONTHLY': { code: 'PAID_MONTHLY', price: 149, name: 'Paid Monthly' }
        };

        // Load payment methods on page load
        async function loadPaymentMethods() {
            try {
                const response = await fetch(`${API_URL}/payment/methods`);
                const data = await response.json();
                paymentMethods = data.methods || [];
            } catch (error) {
                console.error('Failed to load payment methods:', error);
            }
        }

        // Initialize
        loadPaymentMethods();

        function selectPlan(planCode) {
            // Check if user is logged in
            const token = localStorage.getItem('token');
            if (!token) {
                alert('Please login or register first to subscribe.');
                window.location.href = 'register.html';
                return;
            }

            const plan = plansData[planCode];
            selectedPlanCode = plan.code;
            currentPrice = plan.price;

            // Update modal info
            document.getElementById('selectedPlanInfo').textContent = `You selected: ${plan.name} - P${plan.price.toLocaleString()}`;
            document.getElementById('subtotalPrice').textContent = `P${plan.price.toLocaleString()}.00`;
            document.getElementById('totalPrice').textContent = `P${plan.price.toLocaleString()}.00`;

            // Reset state
            appliedPromo = null;
            selectedPaymentMethod = null;
            currentPaymentId = null;
            selectedFile = null;
            
            // Reset UI
            document.getElementById('discountRow').classList.add('hidden');
            document.getElementById('promoMessage').classList.add('hidden');
            document.getElementById('promoCodeInput').value = '';
            document.querySelectorAll('.payment-btn').forEach(btn => btn.classList.remove('selected'));
            document.getElementById('paymentInstructions').classList.add('hidden');
            document.getElementById('uploadSection').classList.add('hidden');
            document.getElementById('selectedFile').classList.add('hidden');
            document.getElementById('payerName').value = '';
            document.getElementById('payerContact').value = '';
            document.getElementById('paymentNotes').value = '';
            document.getElementById('proceedBtn').disabled = true;
            document.getElementById('proceedBtnText').textContent = 'Select Payment Method';
            
            // Reset payment methods opacity
            const paymentMethodsEl = document.getElementById('paymentMethods');
            if (paymentMethodsEl) {
                paymentMethodsEl.style.opacity = '1';
                paymentMethodsEl.style.pointerEvents = 'auto';
            }

            // Show modal
            document.getElementById('paymentModal').classList.remove('hidden');
            document.getElementById('paymentModal').classList.add('flex');
        }

        function closePaymentModal() {
            document.getElementById('paymentModal').classList.add('hidden');
            document.getElementById('paymentModal').classList.remove('flex');
            
            // Reset state
            currentPaymentId = null;
            selectedFile = null;
            selectedPaymentMethod = null;
        }

        async function applyPromoCode() {
            const code = document.getElementById('promoCodeInput').value.trim();
            if (!code) return;

            try {
                const response = await fetch(`${API_URL}/payment/validate-promo`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code, planCode: selectedPlanCode })
                });

                const data = await response.json();
                const messageEl = document.getElementById('promoMessage');

                if (data.valid) {
                    appliedPromo = data.promo;
                    let discount = 0;

                    if (data.promo.discountType === 'PERCENTAGE') {
                        discount = currentPrice * (data.promo.discountValue / 100);
                    } else {
                        discount = data.promo.discountValue;
                    }

                    const finalPrice = Math.max(0, currentPrice - discount);

                    document.getElementById('discountRow').classList.remove('hidden');
                    document.getElementById('discountAmount').textContent = `-P${discount.toFixed(2)}`;
                    document.getElementById('totalPrice').textContent = `P${finalPrice.toFixed(2)}`;

                    messageEl.textContent = `Promo applied: ${data.promo.description}`;
                    messageEl.classList.remove('hidden', 'text-red-500');
                    messageEl.classList.add('text-emerald-500');
                } else {
                    messageEl.textContent = data.error || 'Invalid promo code';
                    messageEl.classList.remove('hidden', 'text-emerald-500');
                    messageEl.classList.add('text-red-500');
                }
            } catch (error) {
                console.error('Promo validation error:', error);
            }
        }

        function selectPaymentMethod(method) {
            selectedPaymentMethod = method;

            // Update UI
            document.querySelectorAll('.payment-btn').forEach(btn => btn.classList.remove('selected'));
            event.currentTarget.classList.add('selected');

            // Get payment method details from loaded data
            const methodDetails = paymentMethods.find(m => m.payment_method === method);
            
            if (methodDetails) {
                // Show instructions
                document.getElementById('instructionsText').textContent = methodDetails.instructions || '';
                
                // Show account details
                let accountInfo = '';
                if (method === 'BANK_TRANSFER') {
                    accountInfo = `${methodDetails.bank_name || ''}\nAccount: ${methodDetails.account_number || ''}\nName: ${methodDetails.account_name || ''}`;
                } else {
                    accountInfo = `${methodDetails.account_number || ''}\n${methodDetails.account_name || ''}`;
                }
                document.getElementById('accountDetails').textContent = accountInfo;
                
                document.getElementById('paymentInstructions').classList.remove('hidden');
                document.getElementById('proceedBtn').disabled = false;
                document.getElementById('proceedBtnText').textContent = 'Initiate Payment';
            }
        }

        function handleFileSelect(event) {
            selectedFile = event.target.files[0];
            if (selectedFile) {
                // Validate file size (5MB)
                if (selectedFile.size > 5 * 1024 * 1024) {
                    alert('File size must be less than 5MB');
                    selectedFile = null;
                    return;
                }
                
                // Show selected file
                document.getElementById('fileName').textContent = selectedFile.name;
                document.getElementById('selectedFile').classList.remove('hidden');
                
                // Enable submit if all required fields filled
                updateSubmitButton();
            }
        }

        function updateSubmitButton() {
            const payerName = document.getElementById('payerName').value.trim();
            const payerContact = document.getElementById('payerContact').value.trim();
            const hasFile = selectedFile !== null;
            
            const canSubmit = hasFile && payerName && payerContact;
            document.getElementById('proceedBtn').disabled = !canSubmit;
            
            if (canSubmit) {
                document.getElementById('proceedBtnText').textContent = 'Submit Payment Proof';
            }
        }

        // Add input listeners
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('payerName')?.addEventListener('input', updateSubmitButton);
            document.getElementById('payerContact')?.addEventListener('input', updateSubmitButton);
        });

        async function proceedToPayment() {
            if (!selectedPaymentMethod || !selectedPlanCode) return;

            const token = localStorage.getItem('token');
            if (!token) {
                alert('Please login first');
                return;
            }

            const btn = document.getElementById('proceedBtn');
            const btnText = document.getElementById('proceedBtnText');
            const originalText = btnText.textContent;

            try {
                // If payment not yet initiated, initiate it
                if (!currentPaymentId) {
                    btn.disabled = true;
                    btnText.textContent = 'Initiating payment...';

                    const response = await fetch(`${API_URL}/payment/initiate`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({
                            plan_code: selectedPlanCode,
                            payment_method: selectedPaymentMethod
                        })
                    });

                    const data = await response.json();

                    if (response.ok) {
                        // Payment initiated successfully
                        currentPaymentId = data.payment_id;
                        
                        // Show upload section
                        document.getElementById('uploadSection').classList.remove('hidden');
                        document.getElementById('paymentReference').textContent = data.reference_number;
                        
                        // Hide payment method selection
                        document.getElementById('paymentMethods').style.opacity = '0.5';
                        document.getElementById('paymentMethods').style.pointerEvents = 'none';
                        
                        // Update button
                        btnText.textContent = 'Upload Payment Proof';
                        btn.disabled = true; // Will be enabled when file selected
                    } else {
                        alert(data.error || 'Failed to initiate payment');
                        btn.disabled = false;
                        btnText.textContent = originalText;
                    }
                } 
                // If payment initiated, upload proof
                else {
                    if (!selectedFile) {
                        alert('Please select a payment proof file');
                        return;
                    }

                    const payerName = document.getElementById('payerName').value.trim();
                    const payerContact = document.getElementById('payerContact').value.trim();
                    const paymentNotes = document.getElementById('paymentNotes').value.trim();

                    if (!payerName || !payerContact) {
                        alert('Please fill in your name and contact number');
                        return;
                    }

                    btn.disabled = true;
                    btnText.textContent = 'Uploading proof...';

                    // Create FormData for file upload
                    const formData = new FormData();
                    formData.append('proof', selectedFile);
                    formData.append('payer_name', payerName);
                    formData.append('payer_contact', payerContact);
                    formData.append('payment_notes', paymentNotes);

                    const response = await fetch(`${API_URL}/payment/${currentPaymentId}/upload-proof`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`
                        },
                        body: formData
                    });

                    const data = await response.json();

                    if (response.ok) {
                        // Show success modal
                        closePaymentModal();
                        document.getElementById('referenceNumber').textContent = document.getElementById('paymentReference').textContent;
                        document.getElementById('confirmInstructions').textContent = 
                            'Your payment proof has been uploaded successfully! We will verify your payment within 24 hours and activate your subscription.';
                        document.getElementById('confirmationModal').classList.remove('hidden');
                        document.getElementById('confirmationModal').classList.add('flex');
                        
                        // Reset state
                        currentPaymentId = null;
                        selectedFile = null;
                    } else {
                        alert(data.error || 'Failed to upload payment proof');
                        btn.disabled = false;
                        btnText.textContent = 'Submit Payment Proof';
                    }
                }
            } catch (error) {
                console.error('Payment error:', error);
                alert('Failed to process payment');
                btn.disabled = false;
                btnText.textContent = originalText;
            }
        }

            try {
                const response = await fetch(`${API_URL}/payment/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        planCode: selectedPlanCode,
                        paymentProvider: selectedPaymentMethod,
                        promoCode: appliedPromo?.code || null
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    // Show confirmation modal
                    closePaymentModal();
                    document.getElementById('referenceNumber').textContent = data.transaction.reference;
                    document.getElementById('confirmInstructions').textContent = data.transaction.instructions;
                    document.getElementById('confirmationModal').classList.remove('hidden');
                    document.getElementById('confirmationModal').classList.add('flex');
                } else {
                    alert(data.error || 'Failed to create payment');
                }
            } catch (error) {
                console.error('Payment creation error:', error);
                alert('Failed to create payment. Please try again.');
            }
        }

        function closeConfirmationModal() {
            document.getElementById('confirmationModal').classList.add('hidden');
            document.getElementById('confirmationModal').classList.remove('flex');
            window.location.href = 'dashboard.html';
        }

        // Close modal on outside click
        document.getElementById('paymentModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('paymentModal')) {
                closePaymentModal();
            }
        });
    </script>
</body>
</html>
